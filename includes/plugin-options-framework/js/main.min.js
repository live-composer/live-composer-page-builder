jQuery(document).ready(function () {
  jQuery("#lc_caching_engine").after(
    ' <a href="#" class="dslc-clear-cache" onclick="dslc_clear_cache(event)"><span class="dashicons dashicons-trash"></span> clear cache</a>'
  );
  function a(e) {
    var t,
      s = jQuery(".dslca-plugin-opts-list-code", e),
      a = "",
      l = false;
    var i = [];
    jQuery(".dslca-plugin-opts-list-item", e).each(function () {
      if (
        jQuery.inArray(
          jQuery(this).find(".dslca-plugin-opts-list-title").text(),
          i
        ) !== -1
      ) {
        l = true;
      } else {
        i.push(jQuery(this).find(".dslca-plugin-opts-list-title").text());
      }
    });
    if (l) {
      jQuery(".dslca-plugin-opts-list-error").show();
    } else {
      jQuery(".dslca-plugin-opts-list-error").hide();
    }
    jQuery(".dslca-plugin-opts-list-item", e).each(function () {
      t = jQuery(this).find(".dslca-plugin-opts-list-title").text();
      t = t.replace(/([^a-z0-9 ]+)/gi, "");
      jQuery(this).find(".dslca-plugin-opts-list-title").text(t);
      a += t.trim() + ",";
    });
    s.val(a);
  }
  jQuery(".dslca-plugin-opts-list-add-hook").click(function (e) {
    e.preventDefault();
    var t = jQuery(this).closest(".dslca-plugin-opts-list-wrap");
    var s = t.find(".dslca-plugin-opts-list");
    jQuery(
      '<div class="dslca-plugin-opts-list-item"><span class="dslca-plugin-opts-list-title" contenteditable="true">Click to edit</span><a href="#" class="dslca-plugin-opts-list-delete-hook">delete</a></div>'
    ).appendTo(s);
    a(t);
  });
  jQuery(document).on(
    "click",
    ".dslca-plugin-opts-list-delete-hook",
    function (e) {
      e.preventDefault();
      var t = jQuery(this).closest(".dslca-plugin-opts-list-wrap");
      var s = jQuery(this).closest(".dslca-plugin-opts-list-item");
      s.remove();
      a(t);
    }
  );
  jQuery(document).on("blur", ".dslca-plugin-opts-list-title", function () {
    var e = jQuery(this).closest(".dslca-plugin-opts-list-wrap");
    a(e);
  });
  jQuery(document).on(
    "keypress",
    ".dslca-plugin-opts-list-title",
    function (e) {
      if (e.keyCode == 13) {
        jQuery(this).trigger("blur");
        e.preventDefault();
      }
    }
  );
  jQuery(document).on("click", ".lc-toggle-extension", function (e) {
    e.preventDefault();
    $extensionId = e.target.getAttribute("data-id");
    var t = jQuery(e.target).closest(".extension");
    if (t[0] !== undefined) {
      t = t[0];
    } else {
      console.error("Can't find extension parent for the clicked ellement.");
      return false;
    }
    var s = t.getAttribute("data-extension-status");
    t.setAttribute("data-extension-status", "pending");
    jQuery
      .ajax({
        type: "POST",
        data: {
          security: dslcajax,
          action: "dslc-ajax-toggle-extension",
          extension: $extensionId,
        },
        url: ajaxurl,
      })
      .done(function (e) {
        if (e) {
          t.setAttribute("data-extension-status", e);
        } else {
          t.setAttribute("data-extension-status", s);
        }
      })
      .fail(function (e) {
        t.setAttribute("data-extension-status", s);
      });
  });
});
function dslc_clear_cache(e) {
  e.preventDefault();
  jQuery(".dslc-clear-cache .dashicons")
    .removeClass("dashicons-trash")
    .addClass("dashicons-update dashicon-spin");
  jQuery
    .ajax({
      type: "POST",
      data: { security: dslcajax, action: "dslc_ajax_clear_cache" },
      url: ajaxurl,
    })
    .done(function () {
      jQuery(".dslc-clear-cache").css("color", "green");
      jQuery(".dslc-clear-cache").text("done");
      jQuery(".dslc-clear-cache").prepend(
        '<span class="dashicons dashicons-yes"></span> '
      );
    });
}
